(function(a){function c(b){var c=encodeURIComponent(b.info.authentication_db),d=encodeURIComponent(b.userCtx.name),e=a('<span>Welcome <a target="_new" href="/_utils/document.html?'+c+"/org.couchdb.user%3A"+d+'" class="name"></a>! <a href="#logout">Logout?</a></span>');a("a.name",e).text(b.userCtx.name);return e}a.fn.couchLogin=function(d){function g(b,c){a.couch.login({name:b,password:c,success:f})}function f(){a.couch.session({success:function(a){var f=a.userCtx;f.name?(e.empty(),e.append(c(a)),d.loggedIn&&d.loggedIn(f)):f.roles.indexOf("_admin")!=-1?e.html(b.adminParty):(e.html(b.loggedOut),d.loggedOut&&d.loggedOut())}})}var e=a(this);d=d||{},f(),e.delegate("a[href=#signup]","click",function(){e.html(b.signupForm),e.find('input[name="name"]').focus()}),e.delegate("a[href=#login]","click",function(){e.html(b.loginForm),e.find('input[name="name"]').focus()}),e.delegate("a[href=#logout]","click",function(){a.couch.logout({success:f})}),e.delegate("form.login","submit",function(){g(a("input[name=name]",this).val(),a("input[name=password]",this).val());return!1}),e.delegate("form.signup","submit",function(){var b=a("input[name=name]",this).val(),c=a("input[name=password]",this).val();a.couch.signup({name:b},c,{success:function(){g(b,c)}});return!1})};var b={adminParty:'<p><strong>Admin party, everyone is admin!</strong> Fix this in <a href="/_utils/index.html">Futon</a> before proceeding.</p>',loggedOut:'<a href="#signup">Signup</a> or <a href="#login">Login</a>',loginForm:'<form class="login"><label for="name">Name</label> <input type="text" name="name" value="" autocapitalize="off" autocorrect="off"><label for="password">Password</label> <input type="password" name="password" value=""><input type="submit" value="Login"><a href="#signup">or Signup</a></form>',signupForm:'<form class="signup"><label for="name">Name</label> <input type="text" name="name" value="" autocapitalize="off" autocorrect="off"><label for="password">Password</label> <input type="password" name="password" value=""><input type="submit" value="Signup"><a href="#login">or Login</a></form>'}})(jQuery)